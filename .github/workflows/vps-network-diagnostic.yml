name: VPS Network Diagnostic

on:
  workflow_dispatch:

jobs:
  network-test:
    runs-on: ubuntu-latest
    steps:
      - name: Test VPS Connectivity from GitHub Actions
        run: |
          echo "üîç Testing VPS connectivity from GitHub Actions..."
          echo ""
          
          echo "1Ô∏è‚É£ Testing SSH port 22:"
          if timeout 10 bash -c 'cat < /dev/null > /dev/tcp/72.60.176.200/22'; then
            echo "‚úÖ Port 22 (SSH) is reachable"
          else
            echo "‚ùå Port 22 (SSH) is not reachable"
          fi
          
          echo ""
          echo "2Ô∏è‚É£ Testing HTTP port 8080:"
          if timeout 10 bash -c 'cat < /dev/null > /dev/tcp/72.60.176.200/8080'; then
            echo "‚úÖ Port 8080 (Frontend) is reachable"
            curl -I http://72.60.176.200:8080/ || echo "HTTP request failed"
          else
            echo "‚ùå Port 8080 (Frontend) is not reachable"
          fi
          
          echo ""
          echo "3Ô∏è‚É£ Testing API port 5001:"
          if timeout 10 bash -c 'cat < /dev/null > /dev/tcp/72.60.176.200/5001'; then
            echo "‚úÖ Port 5001 (Backend) is reachable"
            curl http://72.60.176.200:5001/health || echo "API request failed"
          else
            echo "‚ùå Port 5001 (Backend) is not reachable"
          fi
          
          echo ""
          echo "4Ô∏è‚É£ GitHub Actions source IP:"
          curl -s https://httpbin.org/ip | jq -r '.origin'
          
          echo ""
          echo "5Ô∏è‚É£ Testing hostname resolution:"
          nslookup srv1001041.hstgr.cloud || echo "DNS lookup failed"